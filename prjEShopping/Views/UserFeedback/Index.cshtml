@model prjEShopping.Models.ViewModels.UserFeedbackVM
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div id="starContainer">
    @for (int i = 1; i <= 5; i++)
    {
        <img class="star" src="@Url.Content("~/img/star.gif")" data-value="@i" />
    }
</div>

<p id="selectedRatingText">請評分：</p>
<input type="button" class="btn btn-primary reset" value="重新評分" />
@using (Html.BeginForm("SubmitComment", "Comment", FormMethod.Post))
{
    @Html.HiddenFor(model => model.StarRating, new { @id = "starRating" })
    @Html.HiddenFor(model => model.RatingText) <!-- 新增隱藏字段，用於存儲RatingText -->
    <div class="form-group">
        
        @Html.TextAreaFor(model => model.RatingText, new { @class = "form-control", rows = 4 })
    </div>
    <button type="submit" class="btn btn-primary">提交評分留言</button>
}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var countStars = 0;
    var hasClicked = false;

    function into(e) {
        if (!hasClicked) {
            $(e.currentTarget)
                .prevAll("img")
                .prop("src", "@Url.Content("~/img/chngstar.gif")")
                .end()
                .prop("src", "@Url.Content("~/img/chngstar.gif")");

            countStars = $("img.star").index(e.currentTarget) + 1;

            $("#selectedRatingText").text("評分中..." + countStars + "星");
        }
    }

    let out = (e) => {
        if (!hasClicked) {
            $(e.currentTarget)
                .prevAll("img")
                .prop("src", "@Url.Content("~/img/star.gif")")
                .end()
                .prop("src", "@Url.Content("~/img/star.gif")");

            $("#selectedRatingText").text("請評分");
        }
    }

    $("img.star").hover(into, out);

    $("img.star").click(function (e) {
        hasClicked = true;

        $(e.currentTarget)
            .prevAll()
            .prop("src", "@Url.Content("~/img/chngstar.gif")")
            .end()
            .prop("src", "@Url.Content("~/img/chngstar.gif")")
            .nextAll()
            .prop("src", "@Url.Content("~/img/star.gif")");

        countStars = $("img.star").index(e.currentTarget) + 1;
        $("#selectedRatingText").text("你給" + countStars + "顆星");

        // 存儲選中的星星數量到隱藏字段
        $("#starRating").val(countStars);
    });

    $(".reset").click(function () {
        countStars = 0;
        hasClicked = false;

        $("img.star").prop("src", "@Url.Content("~/img/star.gif")");

        $("#selectedRatingText").text("請評分");
    });
</script>
