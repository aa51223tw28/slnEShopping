
@{
    ViewBag.Title = "Comment";
}

<div class="col-7 pt-5">
    <div class="row">
        <div class="col-3 d-flex align-items-center">
            <span>品名：</span>
        </div>
        <div class="col-9">
            <span class="fs-4 fw-bold">Apple電腦</span>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-3 d-flex align-items-center">
            <span>資訊：</span>
        </div>
        <div class="col-9">
            <div class="d-flex">
                <a href="#">
                    <h5 class="text-danger fw-bold">@ViewBag.AverageStarRating.ToString("0.0")</h5>
                </a><span class="ms-1 me-2">顆星</span>
                <a href="#">
                    <h5 class="text-danger fw-bold">@ViewBag.AllStarCount</h5>
                </a><span class="ms-2 me-2">評價</span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-3 d-flex align-items-center">
            <span>價格：</span>
        </div>
        <div class="col-9">
            <span class="fs-1 fw-bold text-danger">1000</span>
        </div>
    </div>
</div>
<div class="container bg-success rounded py-2 mt-3">
    <div class="bg-warning p-3 mb-3">
        <span class="fs-4 fw-bold">商品評價</span>
    </div>

    <p>
        <button class="btn btn-secondary" type="button" onclick="toggleCollapse('allstar')" aria-expanded="false" aria-controls="collapseExample">
            全部<span>(@ViewBag.AllStarCount)</span>
        </button>
        <button class="btn btn-secondary" type="button" onclick="toggleCollapse('fivestar')" aria-expanded="false" aria-controls="collapseExample">
            5星<span>(@ViewBag.FiveStarCount)</span>
        </button>
        <button class="btn btn-secondary" type="button" onclick="toggleCollapse('fourstar')" aria-expanded="false" aria-controls="collapseExample">
            4星<span>(@ViewBag.FourStarCount)</span>
        </button>
        <button class="btn btn-secondary" type="button" onclick="toggleCollapse('threestar')" aria-expanded="false" aria-controls="collapseExample">
            3星<span>(@ViewBag.ThreeStarCount)</span>
        </button>
        <button class="btn btn-secondary" type="button" onclick="toggleCollapse('twostar')" aria-expanded="false" aria-controls="collapseExample">
            2星<span>(@ViewBag.TwoStarCount)</span>
        </button>
        <button class="btn btn-secondary" type="button" onclick="toggleCollapse('onestar')" aria-expanded="false" aria-controls="collapseExample">
            1星<span>(@ViewBag.OneStarCount)</span>
        </button>
    </p>
    @foreach (var rating in Model)
    {
        <div class="collapse" id="allstar">
            <div class="card card-body">
                <!-- 顯示評分星星 -->
                <div>評分：@rating.StarRating</div>
                <!-- 顯示評論內容 -->
                <div>評論：@rating.RatingText</div>
                <div>買家評論時間：@rating.PostTime</div>
                @if (ViewBag.SellerReplies.ContainsKey(rating.RatingId))
                {
                    <div>賣家回覆：@ViewBag.SellerReplies[rating.RatingId]</div>
                    if (ViewBag.ReplayTime.ContainsKey(rating.RatingId))
                    {
                        <div>賣家評論時間：@ViewBag.ReplayTime[rating.RatingId]</div>
                    }
                }


            </div>
        </div>
    }
    <hr />
    <!-- 五星內容 -->
    <div class="collapse" id="fivestar">
        <div class="card card-body">
            @foreach (var rating in ViewBag.FiveStarRatings)
            {
                <!-- 顯示評分星星 -->
                <div>評分：@rating.StarRating</div>
                <!-- 顯示評論內容 -->
                <div>評論：@rating.RatingText</div>
                <div>買家評論時間：@rating.PostTime</div>
                if (ViewBag.SellerReplies.ContainsKey(rating.RatingId))
                {
                    <div>賣家回覆：@ViewBag.SellerReplies[rating.RatingId]</div>
                    if (ViewBag.ReplayTime.ContainsKey(rating.RatingId))
                    {
                        <div>賣家評論時間：@ViewBag.ReplayTime[rating.RatingId]</div>
                    }
                }
            }
        </div>
    </div>
    <!-- 四星內容 -->
    <div class="collapse" id="allstar">
        <div class="card card-body">
            @foreach (var rating in ViewBag.FourStarRatings)
            {
                <!-- 顯示評分星星 -->
                <div>評分：@rating.StarRating</div>
                <!-- 顯示評論內容 -->
                <div>評論：@rating.RatingText</div>
                <div>買家評論時間：@rating.PostTime</div>
                if (ViewBag.SellerReplies.ContainsKey(rating.RatingId))
                {
                    <div>賣家回覆：@ViewBag.SellerReplies[rating.RatingId]</div>
                    if (ViewBag.ReplayTime.ContainsKey(rating.RatingId))
                    {
                        <div>賣家評論時間：@ViewBag.ReplayTime[rating.RatingId]</div>
                    }
                }
            }
        </div>
    </div>
    <!-- 三星內容 -->
    <div class="collapse" id="allstar">
        <div class="card card-body">
            @foreach (var rating in ViewBag.ThreeStarRatings)
            {<!-- 顯示評分星星 -->
                <div>評分：@rating.StarRating</div>
                <!-- 顯示評論內容 -->
                <div>評論：@rating.RatingText</div>
                <div>買家評論時間：@rating.PostTime</div>
                if (ViewBag.SellerReplies.ContainsKey(rating.RatingId))
                {
                    <div>賣家回覆：@ViewBag.SellerReplies[rating.RatingId]</div>
                    if (ViewBag.ReplayTime.ContainsKey(rating.RatingId))
                    {
                        <div>賣家評論時間：@ViewBag.ReplayTime[rating.RatingId]</div>
                    }
                }
            }
        </div>
    </div>
    <!-- 兩星內容 -->
    <div class="collapse" id="allstar">
        <div class="card card-body">
            @foreach (var rating in ViewBag.TwoStarRatings)
            {
                <!-- 顯示評分星星 -->
                <div>評分：@rating.StarRating</div>
                <!-- 顯示評論內容 -->
                <div>評論：@rating.RatingText</div>
                <div>買家評論時間：@rating.PostTime</div>
                if (ViewBag.SellerReplies.ContainsKey(rating.RatingId))
                {
                    <div>賣家回覆：@ViewBag.SellerReplies[rating.RatingId]</div>
                    if (ViewBag.ReplayTime.ContainsKey(rating.RatingId))
                    {
                        <div>賣家評論時間：@ViewBag.ReplayTime[rating.RatingId]</div>
                    }
                }
            }
        </div>
    </div>
    <!-- 一星內容 -->
    <div class="collapse" id="allstar">
        <div class="card card-body">
            @foreach (var rating in ViewBag.OneStarRatings)
            {
                <!-- 顯示評分星星 -->
                <div>評分：@rating.StarRating</div>
                <!-- 顯示評論內容 -->
                <div>評論：@rating.RatingText</div>
                <div>買家評論時間：@rating.PostTime</div>
                if (ViewBag.SellerReplies.ContainsKey(rating.RatingId))
                {
                    <div>賣家回覆：@ViewBag.SellerReplies[rating.RatingId]</div>
                    if (ViewBag.ReplayTime.ContainsKey(rating.RatingId))
                    {
                        <div>賣家評論時間：@ViewBag.ReplayTime[rating.RatingId]</div>
                    }
                }
            }
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- 在頁面底部加入以下腳本 -->
<script>
    // 顯示初始的星級內容（全部）
    $(document).ready(function () {
        $("#allstar").addClass("show");
    });

    //商品評價要用js判斷只留最新按的按紐
    let activeCollapse = null;

    // 切換評價內容的函數
    function toggleCollapse(collapseId) {
        if (activeCollapse !== collapseId) {
            // 隱藏上一個 active 的 collapse
            if (activeCollapse !== null) {
                document.getElementById(activeCollapse).classList.remove('show');
            }
            // 顯示新的 active collapse
            document.getElementById(collapseId).classList.add('show');
            activeCollapse = collapseId;
        } else {
            // 如果已經是 active 的按鈕，再次點擊時隱藏該 collapse
            document.getElementById(collapseId).classList.remove('show');
            activeCollapse = null;
        }
    }
</script>
